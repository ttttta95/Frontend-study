## 가상 돔 (Virtual DOM)

리액트가 많은 개발자들 사이에서 엄청난 사랑을 받는 이유 중 한 가지는 바로 빠른 처리 속도 덕분이다. 리액트는 가상 돔을 사용해 보다 효율적으로 우리가 원하는 페이지를 브라우저에 빠르게 그려준다. 지금부터 가상 돔이 어떻게 처리 속도를 높였는지에 대해 알아보고자 한다.

<br />

### DOM (Document Object Model)
- DOM이란 `HTML element들을 tree 형태`로 표현한 것이다.
- 개발자들은 DOM이 제공하는 API를 통해 DOM 구조에 접근을 하고, 원하는 Element들을 조작할 수 있다.

그렇다면 Virtual DOM이라는 것은 과연 무엇일까?

<br />

### virtual DOM
- 실제 돔과 같은 내용을 담고 있는 복사본이다. `복사본`은 실제 DOM이 아닌 `JS 객체형태`로 메모리 안에 저장되어 있다.
- 실제 돔과의 차이점은 브라우저에 있는 `문서에 직접적으로 접근할 수 없다`. 따라서, 문서 내용을 직접 수정할 수가 없다.

> 가상 돔을 쓰는 이유는 DOM을 조작하는 시간을 획기적으로 줄여주기 때문이다.

### 리액트는 항상 두 개의 가상돔 객체를 가지고 있다.
```
렌더링 "이전 화면 구조"를 나타내는 가상돔
렌더링 "이후에 보이게 될 화면 구조"를 나타내는 가상돔
```

<br />

### 가상 돔의 비교 과정
- 리액트는 State가 변경될 때마다 리렌더링이 발생하는데, 이 시점마다 새로운 내용이 담긴 가상돔을 생성하게 된다.
- 렌더링 이전에 두 가상돔을 비교해 정확히 어떤 Element가 변했는지를 비교한다. 이를 리액트에선 `Diffing`이라고 표현한다.
- `Diffing`은 효율적인 알고리즘을 사용해 진행되기 때문에 어떤 Element에 차이가 있는지를 매우 신속하게 파악할 수 있게 된다.

> 리액트는 이를 통해 `차이가 발생한 부분만`을 (브라우저상의) `실제 DOM에 적용`하게 되는 것이다.

<br />

### 재조정(Reconciliation)
- 이 과정을 재조정이라고 한다. 이 과정이 매우 효율적인 이유는 `Batch Update`때문인데, 이는 변경된 모든 element들을 집단화 시켜 이를 한 번에 실제 DOM에 적용하는 방식이다.
- 예를 들어 리스트안에 10개의 항목이 바뀌었다면 실제 DOM을 10번 반복해 수정하는 것이 아닌, 한 번에 집단화시켜 이를 적용한다는 것이다.
- DOM 조작에 비용이 가장 많이 발생하는 지점은 브라우저에 화면을 그려주는 작업이다. Batch Update는 변경된 Element를 별개로 그려주는 것이 아니라 변경된 내용을 한 번에 받아와 이를 실제 DOM에 한번에 적용시켜주기 때문에 효율적인 것이다.

<br />

- 가상 돔은 DOM을 조작하는 시간을 줄이기 위해 사용된다.
- 리액트에서는 두 개의 가상돔을 비교하는 `Diffing` 과정을 통해 `차이가 발생한 부분만`을 실제 DOM에 적용한다.
- 이 과정을 재조정이라고 하는데, 재조정이 효율적인 이유는 Batch Update 때문이다. 브라우저에 화면을 그려주는 비용이 많이 발생하는 작업을 한 번에 변경하여 비용을 절약할 수 있게 해준다.
